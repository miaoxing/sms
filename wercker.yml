box: miaoxing/php56-fpm:build

services:
  - id: mysql:5.6
    env:
      MYSQL_ROOT_PASSWORD: mypassword

build:
  steps:
    - script:
        name: wait for mysql connection
        code: |
          while ! nc -q 1 $MYSQL_PORT_3306_TCP_ADDR $MYSQL_PORT_3306_TCP_PORT < /dev/null; do sleep 2; done
    - mbrevda/composer-install@1.0.1
    - script:
        name: PHPUnit integration tests
        code: phpunit --verbose --stderr
    - script:
        name: perform project mess detection using PHPMD
        code: phpmd . text vendor/miaoxing/plugin/tests/phpmd.xml --exclude vendor --ignore-violations-on-exit
  after-steps:
    - miaoxing/github-issue-notify:
        token: $GITHUB_ISSUE_TOKEN
        repo: $GITHUB_ISSUE_REPO
